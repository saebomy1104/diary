<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>â˜ï¸ Sky OS : Sae-bom's Pink World â˜ï¸</title>
    
    <!-- ì•„ì´ì½˜ & í°íŠ¸ -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fonts-archive/Paperlogy/Paperlogy.css" type="text/css"/>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- ìŠ¤íƒ€ì¼ ì„¤ì • -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-pink': '#FF80AB',
                        'soft-pink': '#FFB7C5',
                        'bg-pink': '#FFF0F5',
                    },
                    fontFamily: {
                        'sans': ['Paperlogy', 'sans-serif'],
                        'hand': ['Paperlogy', 'sans-serif'],
                    },
                    animation: {
                        'bounce-slight': 'bounceSlight 2s infinite',
                        'pop-in': 'popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275)',
                        'float-heart': 'floatHeart 6s ease-in-out infinite',
                    },
                    keyframes: {
                        bounceSlight: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' },
                        },
                        popIn: {
                            'from': { transform: 'scale(0.95)', opacity: '0' },
                            'to': { transform: 'scale(1)', opacity: '1' }
                        },
                        floatHeart: {
                            '0%, 100%': { transform: 'translateY(0) rotate(0deg)' },
                            '50%': { transform: 'translateY(-20px) rotate(10deg)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { margin: 0; overflow: hidden; font-family: 'Paperlogy', sans-serif; user-select: none; }
        input, textarea { user-select: text !important; }
        
        /* ë°°ê²½ ìº”ë²„ìŠ¤ */
        #sky-canvas { 
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; 
            background: linear-gradient(to bottom, #FFC3A0, #FFAFBD); 
        }

        /* ë°°ê²½ íŒ¨í„´ */
        #bg-pattern {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            pointer-events: none; opacity: 0.15;
            background-image: radial-gradient(#ffffff 2px, transparent 2px), radial-gradient(#ffffff 2px, transparent 2px);
            background-size: 30px 30px;
            background-position: 0 0, 15px 15px; 
        }
        
        /* ìœˆë„ìš° ìŠ¤íƒ€ì¼ */
        .window-frame {
            position: absolute;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 1);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(255, 182, 193, 0.3);
            display: flex; flex-direction: column; overflow: hidden;
            transition: transform 0.1s, opacity 0.2s;
            animation: popIn 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .window-frame.active { 
            box-shadow: 0 25px 70px rgba(255, 105, 180, 0.25); 
            z-index: 100; 
            border: 2px solid #FFB7C5; 
        }
        .window-header { 
            padding: 10px 15px; 
            background: rgba(255, 240, 245, 0.95); 
            border-bottom: 1px solid #FFE4E1; 
            display: flex; justify-content: space-between; align-items: center; cursor: grab; 
        }
        .window-header:active { cursor: grabbing; }
        .window-content { flex: 1; overflow: auto; position: relative; }

        /* ë…ë°” */
        .dock-container {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(20px);
            border: 1px solid white; border-radius: 24px;
            padding: 10px 20px; display: flex; gap: 16px; z-index: 1000;
            box-shadow: 0 5px 20px rgba(255, 105, 180, 0.2);
        }
        .dock-item {
            width: 50px; height: 50px; border-radius: 14px; background: rgba(255,255,255,0.8);
            display: flex; justify-content: center; align-items: center; font-size: 24px; color: #FF80AB;
            cursor: pointer; transition: all 0.2s; position: relative;
        }
        .dock-item:hover { transform: translateY(-10px) scale(1.1); background: #FFF0F5; color: #FF69B4; }
        
        /* ìº˜ë¦°ë” */
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-day {
            min-height: 100px; padding: 6px; border-radius: 8px; cursor: pointer;
            background: white; border: 1px solid #FFF0F5; transition: all 0.2s;
            display: flex; flex-direction: column; overflow: hidden; position: relative;
        }
        .calendar-day:hover { background: #FFF0F5; border-color: #FFB7C5; transform: scale(1.02); z-index: 10; shadow: md; }
        .calendar-day.today { border: 2px solid #FF69B4; background: #FFF5F8; }
        .calendar-day.today .day-num { background: #FF69B4; color: white; padding: 2px 6px; border-radius: 8px; display: inline-block; }
        
        /* ì¼ì • ìŠ¤íƒ€ì¼ */
        .schedule-item { font-size: 11px; padding: 2px 4px; border-radius: 4px; margin-top: 2px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .schedule-item.yearly { background-color: #FEF3C7; color: #D97706; border-left: 2px solid #F59E0B; }
        .schedule-item.monthly { background-color: #FCE7F3; color: #BE185D; border-left: 3px solid #FF69B4; }
        
        /* ì´ì–¼ë¦¬ */
        .yearly-month { background: white; border-radius: 12px; padding: 8px; border: 1px solid #FFE4E1; }
        .yearly-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 1px; }
        .yearly-day { font-size: 9px; text-align: center; padding: 2px 0; cursor: pointer; border-radius: 2px; }
        .yearly-day:hover { background: #FFB7C5; color: white; }
        .yearly-day.has-anniversary { background: #FCD34D; color: #78350F; font-weight: bold; }

        /* ì»¤ìŠ¤í…€ ëª¨ë‹¬ */
        .custom-modal-overlay {
            position: fixed; inset: 0; background: rgba(255, 230, 240, 0.6); backdrop-filter: blur(2px); z-index: 9999;
            display: flex; align-items: center; justify-content: center; animation: fadeIn 0.2s;
        }
        .custom-modal-box {
            background: white; padding: 20px; border-radius: 20px; width: 340px;
            box-shadow: 0 10px 40px rgba(255, 105, 180, 0.2); border: 2px solid #FFB7C5;
            animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        
        /* ê·¸ë¦¼ì¼ê¸° ìŠ¤íƒ€ì¼ */
        .diary-modal { width: 420px !important; }
        .picture-frame {
            width: 100%; aspect-ratio: 4/3; background: #f8f8f8; border: 2px dashed #ddd; border-radius: 12px;
            display: flex; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; position: relative;
            transition: all 0.2s;
        }
        .picture-frame:hover { border-color: #FFB7C5; background: #fff0f5; }
        .picture-frame img { width: 100%; height: 100%; object-fit: cover; }
        
        .meta-selector { display: flex; gap: 4px; justify-content: center; }
        .meta-icon { 
            width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 16px; border: 1px solid transparent; background: #fff;
        }
        .meta-icon.selected { background: #FFF0F5; border-color: #FF69B4; transform: scale(1.1); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        
        .lined-paper {
            background-image: linear-gradient(#eee 1px, transparent 1px);
            background-size: 100% 1.5em;
            line-height: 1.5em;
            padding: 0.2em;
            border: none;
            resize: none;
            outline: none;
            width: 100%;
        }

        /* ì•„ì´ì½˜ ì„ íƒê¸° */
        .icon-selector { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; margin-bottom: 10px; }
        .icon-option { 
            width: 36px; height: 36px; border-radius: 50%; background: #FFF0F5; 
            display: flex; align-items: center; justify-content: center; cursor: pointer; font-size: 18px; flex-shrink: 0; border: 2px solid transparent;
        }
        .icon-option.selected { border-color: #FF69B4; background: white; transform: scale(1.1); box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        /* ë‹¤ì´ì–´ë¦¬ ë·°ì–´ (í¬í†  ìº˜ë¦°ë”) */
        .photo-calendar-grid {
            display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; padding: 4px;
        }
        .photo-calendar-day {
            aspect-ratio: 1; border-radius: 8px; overflow: hidden; position: relative; background: #FFF0F5; border: 1px solid white; cursor: pointer;
            transition: transform 0.2s;
        }
        .photo-calendar-day:hover { transform: scale(1.05); z-index: 10; box-shadow: 0 4px 10px rgba(255,183,197,0.4); }
        .photo-calendar-day img { width: 100%; height: 100%; object-fit: cover; }
        .photo-calendar-day .day-num {
            position: absolute; top: 4px; left: 4px; background: rgba(255,255,255,0.8); 
            padding: 2px 6px; border-radius: 6px; font-size: 10px; font-weight: bold; color: #FF69B4;
        }
        .photo-calendar-day .no-img {
            width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; font-size: 20px; color: #FFB7C5;
        }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: rgba(255, 183, 197, 0.5); border-radius: 3px; }
    </style>
</head>
<body class="text-slate-700 selection:bg-pink-200 selection:text-white">

    <!-- ë¡œë”© (í•‘í¬) -->
    <div id="loading-screen" class="fixed inset-0 z-[9999] bg-[#FFB7C5] flex flex-col items-center justify-center transition-opacity duration-700">
        <i class="fas fa-heart text-6xl text-white animate-bounce mb-4"></i>
        <h1 class="text-3xl font-bold text-white tracking-widest">Sky Mini-Hompy</h1>
        <p class="text-white/90 mt-2">ìƒˆë´„ì´ì˜ í•‘í¬ë¹› í•˜ë£¨ ë¡œë”© ì¤‘... ğŸ€</p>
    </div>

    <!-- ë°°ê²½ -->
    <div id="bg-pattern"></div>
    <canvas id="sky-canvas"></canvas>

    <!-- ì•„ì´ì½˜ -->
    <div class="absolute top-8 left-8 flex flex-col gap-6 z-10">
        <div class="group flex flex-col items-center gap-2 cursor-pointer hover:scale-105 transition" onclick="app.openWindow('profile')">
            <div class="w-16 h-16 bg-white/40 backdrop-blur rounded-2xl flex items-center justify-center border border-white/60 shadow-lg group-hover:bg-white/70">
                <i class="fas fa-user-astronaut text-3xl text-pink-500"></i>
            </div>
            <span class="text-white font-bold drop-shadow-md text-sm bg-pink-400/50 px-2 rounded">ë‚´ í”„ë¡œí•„</span>
        </div>
        <div class="group flex flex-col items-center gap-2 cursor-pointer hover:scale-105 transition" onclick="app.openWindow('goal')">
            <div class="w-16 h-16 bg-white/40 backdrop-blur rounded-2xl flex items-center justify-center border border-white/60 shadow-lg group-hover:bg-white/70">
                <i class="fas fa-bullseye text-3xl text-red-400"></i>
            </div>
            <span class="text-white font-bold drop-shadow-md text-sm bg-pink-400/50 px-2 rounded">ëª©í‘œ</span>
        </div>
        
        <!-- NEW: ì¼ê¸°ì¥ (ë‚®/ë°¤ ìœ„ìª½) -->
        <div class="group flex flex-col items-center gap-2 cursor-pointer hover:scale-105 transition" onclick="app.openWindow('diary_viewer')">
             <div class="w-16 h-16 bg-white/40 backdrop-blur rounded-2xl flex items-center justify-center border border-white/60 shadow-lg group-hover:bg-white/70">
                <i class="fas fa-book-open text-3xl text-pink-500"></i>
            </div>
            <span class="text-white font-bold drop-shadow-md text-sm bg-pink-400/50 px-2 rounded">ê·¸ë¦¼ì¼ê¸°</span>
        </div>

        <div class="group flex flex-col items-center gap-2 cursor-pointer hover:scale-105 transition" onclick="app.toggleTheme()">
             <div class="w-16 h-16 bg-white/40 backdrop-blur rounded-2xl flex items-center justify-center border border-white/60 shadow-lg group-hover:bg-white/70">
                <i id="theme-icon" class="fas fa-sun text-3xl text-yellow-400"></i>
            </div>
            <span class="text-white font-bold drop-shadow-md text-sm bg-pink-400/50 px-2 rounded">ë‚®/ë°¤</span>
        </div>
    </div>

    <!-- ìš°ì¸¡ ìƒë‹¨ ìœ„ì ¯ -->
    <div class="absolute top-8 right-8 text-right text-white select-none pointer-events-none flex flex-col items-end gap-2 z-10">
        <div>
            <h1 id="clock-time" class="text-6xl font-bold tracking-tight text-white drop-shadow-sm">12:00</h1>
            <p id="clock-date" class="text-lg opacity-90 font-bold">2025ë…„ 12ì›” 3ì¼ ìˆ˜ìš”ì¼</p>
        </div>
        <div class="flex items-center gap-2 bg-white/30 backdrop-blur px-3 py-1 rounded-full border border-white/50">
            <i id="weather-icon" class="fas fa-sun text-yellow-300"></i>
            <span id="weather-text" class="text-sm font-bold text-white">ë§‘ìŒ 24Â°C</span>
        </div>
        <div id="dday-widget" class="flex items-center gap-3 bg-white/40 backdrop-blur px-4 py-2 rounded-xl border border-white/50 shadow-lg animate-bounce-slight mt-2 pointer-events-auto cursor-pointer hover:scale-105 transition" onclick="DDayApp.openSettings()">
            <!-- JS -->
        </div>
    </div>

    <!-- ìœˆë„ìš° ì»¨í…Œì´ë„ˆ -->
    <div id="window-container" class="absolute inset-0 pointer-events-none z-20"></div>

    <!-- ë…ë°” -->
    <div class="dock-container z-30">
        <div class="dock-item" onclick="app.openWindow('planner')"><i class="fas fa-calendar-alt text-red-400"></i></div>
        <div class="dock-item" onclick="app.openWindow('notepad')"><i class="fas fa-sticky-note text-yellow-500"></i></div>
        <div class="dock-item" onclick="app.openWindow('todo')"><i class="fas fa-check-square text-green-500"></i></div>
        <div class="dock-item" onclick="app.openWindow('gallery')"><i class="fas fa-camera text-blue-400"></i></div>
    </div>

    <!-- ëª¨ë‹¬ ì»¨í…Œì´ë„ˆ -->
    <div id="modal-container" class="relative z-[9999]"></div>

    <script>
        // --- 0. ë°ì´í„°ë² ì´ìŠ¤ ---
        const DB = {
            save: (key, data) => { try { localStorage.setItem(`skyos_v8_${key}`, JSON.stringify(data)); } catch(e) { console.error('Storage Full'); } },
            load: (key, defaultVal) => { try { const d = localStorage.getItem(`skyos_v8_${key}`); return d ? JSON.parse(d) : defaultVal; } catch(e) { return defaultVal; } }
        };

        const Utils = {
            formatDate: () => new Date().toLocaleDateString('ko-KR', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' }),
            formatTime: () => new Date().toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
            calculateDDay: (dateStr) => Math.floor((new Date() - new Date(dateStr)) / (86400000)) + 1,
            readFile: (f, cb) => { const r = new FileReader(); r.onload = e => cb(e.target.result); r.readAsDataURL(f); }
        };

        // --- 1. ìŠ¤ì¹´ì´ ë Œë”ëŸ¬ ---
        class SkyRenderer {
            constructor() {
                this.cvs = document.getElementById('sky-canvas'); this.ctx = this.cvs.getContext('2d'); this.items = [];
                this.resize(); window.addEventListener('resize', () => this.resize());
                for(let i=0; i<15; i++) this.items.push({x: Math.random()*this.w, y: Math.random()*this.h, s: Math.random()*0.8+0.3, v: Math.random()*0.3+0.1});
                this.loop();
            }
            resize() { this.w = this.cvs.width = window.innerWidth; this.h = this.cvs.height = window.innerHeight; }
            drawHeart(ctx, x, y, size) {
                ctx.save(); ctx.translate(x, y); ctx.scale(size, size); ctx.beginPath();
                ctx.moveTo(0, 0); ctx.bezierCurveTo(-10, -10, -20, 5, 0, 20); ctx.bezierCurveTo(20, 5, 10, -10, 0, 0);
                ctx.fill(); ctx.restore();
            }
            loop() {
                const g = this.ctx.createLinearGradient(0,0,0,this.h);
                if(this.night) { g.addColorStop(0,'#2c3e50'); g.addColorStop(1,'#4ca1af'); } else { g.addColorStop(0,'#FFC3A0'); g.addColorStop(1,'#FFAFBD'); }
                this.ctx.fillStyle = g; this.ctx.fillRect(0,0,this.w,this.h);
                this.items.forEach(c => {
                    c.y -= c.v; if(c.y < -50) c.y = this.h + 50;
                    this.ctx.fillStyle = this.night ? 'rgba(255,255,255,0.2)' : 'rgba(255,255,255,0.6)';
                    this.drawHeart(this.ctx, c.x, c.y, c.s);
                });
                requestAnimationFrame(() => this.loop());
            }
        }

        // --- 2. ìœˆë„ìš° ê´€ë¦¬ì ---
        class WindowManager {
            constructor() { this.el = document.getElementById('window-container'); this.z = 100; this.wins = {}; }
            create(id, title, content, w, h) {
                if(this.wins[id]) { this.front(id); return; }
                const div = document.createElement('div'); div.className = 'window-frame pointer-events-auto'; div.id = `win-${id}`;
                const left = Math.max(20, Math.min(window.innerWidth - w - 20, Math.random() * (window.innerWidth - w)));
                const top = Math.max(20, Math.min(window.innerHeight - h - 60, Math.random() * (window.innerHeight - h)));
                div.style.cssText = `width:${w}px; height:${h}px; left:${left}px; top:${top}px; z-index:${++this.z}`;
                div.innerHTML = `<div class="window-header"><div class="flex gap-2"><div class="w-3 h-3 rounded-full bg-red-400 cursor-pointer hover:scale-110" onclick="app.close('${id}')"></div><div class="w-3 h-3 rounded-full bg-yellow-400"></div><div class="w-3 h-3 rounded-full bg-green-400 cursor-pointer hover:scale-110" onclick="app.max('${id}')"></div></div><span class="font-bold text-gray-600 text-sm">${title}</span><div class="w-4"></div></div><div class="window-content">${content}</div>`;
                this.el.appendChild(div); this.wins[id] = div; this.drag(div, id); div.onmousedown = () => this.front(id);
            }
            close(id) { if(this.wins[id]) { this.wins[id].remove(); delete this.wins[id]; } }
            front(id) { if(this.wins[id]) { this.wins[id].style.zIndex = ++this.z; document.querySelectorAll('.window-frame').forEach(e=>e.classList.remove('active')); this.wins[id].classList.add('active'); } }
            max(id) { const w = this.wins[id]; if(w.dataset.m) { w.style=w.dataset.o; delete w.dataset.m; } else { w.dataset.o=w.style.cssText; w.style.cssText=`width:100%;height:calc(100% - 90px);top:0;left:0;z-index:${++this.z}`; w.dataset.m=1; } }
            drag(el, id) { const h = el.querySelector('.window-header'); let x, y; h.onmousedown = e => { x=e.clientX; y=e.clientY; document.onmousemove = drag; document.onmouseup = stop; this.front(id); }; const drag = e => { el.style.top = (el.offsetTop - (y - e.clientY)) + "px"; el.style.left = (el.offsetLeft - (x - e.clientX)) + "px"; x=e.clientX; y=e.clientY; }; const stop = () => { document.onmousemove = null; document.onmouseup = null; }; }
        }

        // --- 3. D-Day App ---
        const DDayApp = {
            data: {},
            init: () => {
                DDayApp.data = DB.load('my_dday', { date: '2022-10-01', name: 'ê±´ìš©ì´ë‘ ì‚¬ë‘í•œì§€', icon1: 'ğŸ¤´', icon2: 'ğŸ‘¸' });
                DDayApp.render();
            },
            render: () => {
                const days = Utils.calculateDDay(DDayApp.data.date);
                document.getElementById('dday-widget').innerHTML = `<div class="flex -space-x-2 text-lg"><span>${DDayApp.data.icon1}</span><span>${DDayApp.data.icon2}</span></div><div><p class="text-[10px] text-white font-bold">${DDayApp.data.name}</p><p class="text-lg font-extrabold text-white drop-shadow-sm">D + ${days}ì¼ ğŸ’•</p></div>`;
            },
            openSettings: () => {
                const modal = document.createElement('div'); modal.className = 'custom-modal-overlay'; modal.onmousedown = (e) => e.stopPropagation();
                modal.innerHTML = `<div class="custom-modal-box"><h3 class="text-lg font-bold mb-3 text-pink-500">D-Day ì„¤ì •</h3><div class="space-y-3"><div><label class="text-xs text-gray-500">ì œëª©</label><input id="dd-name" class="w-full border p-1 rounded" value="${DDayApp.data.name}"></div><div><label class="text-xs text-gray-500">ë‚ ì§œ</label><input id="dd-date" type="date" class="w-full border p-1 rounded" value="${DDayApp.data.date}"></div><div class="flex gap-2"><div class="flex-1"><label class="text-xs text-gray-500">ì•„ì´ì½˜ 1</label><input id="dd-icon1" class="w-full border p-1 rounded text-center" value="${DDayApp.data.icon1}"></div><div class="flex-1"><label class="text-xs text-gray-500">ì•„ì´ì½˜ 2</label><input id="dd-icon2" class="w-full border p-1 rounded text-center" value="${DDayApp.data.icon2}"></div></div></div><div class="flex justify-end gap-2 mt-4"><button onclick="this.closest('.custom-modal-overlay').remove()" class="px-3 py-1 rounded text-gray-500 bg-gray-100">ì·¨ì†Œ</button><button onclick="DDayApp.save()" class="px-3 py-1 rounded bg-pink-400 text-white font-bold">ì €ì¥</button></div></div>`;
                document.getElementById('modal-container').appendChild(modal);
            },
            save: () => {
                DDayApp.data.name = document.getElementById('dd-name').value; DDayApp.data.date = document.getElementById('dd-date').value; DDayApp.data.icon1 = document.getElementById('dd-icon1').value; DDayApp.data.icon2 = document.getElementById('dd-icon2').value;
                DB.save('my_dday', DDayApp.data); DDayApp.render(); document.querySelector('.custom-modal-overlay').remove();
            }
        };

        // --- NEW: Diary Viewer App (í¬í†  ìº˜ë¦°ë”) ---
        const DiaryViewer = {
            date: new Date(),
            init: () => { DiaryViewer.render(); },
            formatYMD: (y,m,d) => `${y}-${m}-${d}`,
            changeDate: (y, m) => { DiaryViewer.date.setFullYear(y); DiaryViewer.date.setMonth(m-1); DiaryViewer.render(); },
            
            render: () => {
                const el = document.getElementById('app-diary-viewer'); if(!el) return;
                const y = DiaryViewer.date.getFullYear(), m = DiaryViewer.date.getMonth();
                const diaries = DB.load('planner_diary_v2', {});

                let h = `
                    <div class="flex flex-col h-full bg-white/50">
                        <div class="flex justify-between items-center p-4 bg-white/50 border-b border-pink-100">
                            <h2 class="text-xl font-bold text-pink-500">ğŸ“– ê·¸ë¦¼ì¼ê¸° ëª¨ì•„ë³´ê¸°</h2>
                            <div class="flex gap-2">
                                <select onchange="DiaryViewer.changeDate(this.value, ${m+1})" class="bg-white border-2 border-pink-100 rounded-lg px-2 py-1 text-sm text-gray-600 outline-none">${Array.from({length: 11}, (_, i) => y - 5 + i).map(yy => `<option value="${yy}" ${yy===y?'selected':''}>${yy}ë…„</option>`).join('')}</select>
                                <select onchange="DiaryViewer.changeDate(${y}, this.value)" class="bg-white border-2 border-pink-100 rounded-lg px-2 py-1 text-sm text-gray-600 outline-none">${Array.from({length: 12}, (_, i) => i + 1).map(mm => `<option value="${mm}" ${mm===m+1?'selected':''}>${mm}ì›”</option>`).join('')}</select>
                            </div>
                        </div>
                        <div class="photo-calendar-grid flex-1 overflow-auto">
                `;

                const first = new Date(y, m, 1).getDay(); const last = new Date(y, m + 1, 0).getDate();
                for(let i=0; i<first; i++) h += `<div></div>`;
                
                for(let i=1; i<=last; i++) {
                    const dateKey = DiaryViewer.formatYMD(y, m+1, i);
                    const entry = diaries[dateKey];
                    // ì´ë¯¸ì§€ê°€ ìˆìœ¼ë©´ ì´ë¯¸ì§€ í‘œì‹œ, ì—†ìœ¼ë©´ í† ë¼ í‘œì‹œ (ì¼ê¸° ìˆìœ¼ë©´)
                    let content = `<div class="no-img opacity-20"></div>`;
                    if (entry) {
                        if (entry.img) {
                            content = `<img src="${entry.img}">`;
                        } else {
                            content = `<div class="no-img">ğŸ°</div>`; // ì´ë¯¸ì§€ ì—†ëŠ” ì¼ê¸°
                        }
                    }

                    h += `
                        <div class="photo-calendar-day" onclick="DiaryViewer.viewEntry('${dateKey}', ${i})">
                            <span class="day-num">${i}</span>
                            ${content}
                        </div>
                    `;
                }
                h += `</div></div>`;
                el.innerHTML = h;
            },
            
            viewEntry: (dateKey, day) => {
                const diaries = DB.load('planner_diary_v2', {});
                const entry = diaries[dateKey];
                if (!entry) return alert('ì´ ë‚ ì€ ì¼ê¸°ê°€ ì—†ì–´! ğŸ˜¢');
                
                const modal = document.createElement('div');
                modal.className = 'custom-modal-overlay';
                modal.onclick = () => modal.remove();
                
                modal.innerHTML = `
                    <div class="custom-modal-box bg-white p-4 rounded-xl shadow-xl w-[400px]" onclick="event.stopPropagation()">
                        <div class="flex justify-between items-center mb-3 border-b pb-2">
                            <span class="font-bold text-pink-500">${day}ì¼ì˜ ê·¸ë¦¼ì¼ê¸°</span>
                            <div class="flex gap-2 text-lg"><span>${entry.weather}</span><span>${entry.mood}</span></div>
                        </div>
                        <div class="w-full aspect-[4/3] bg-gray-50 rounded-lg overflow-hidden mb-3 border border-gray-100 flex items-center justify-center">
                            ${entry.img ? `<img src="${entry.img}" class="w-full h-full object-cover">` : '<span class="text-gray-300">ì‚¬ì§„ ì—†ìŒ</span>'}
                        </div>
                        <div class="p-3 bg-pink-50/50 rounded-lg text-sm text-gray-700 min-h-[100px] whitespace-pre-wrap leading-relaxed">${entry.text || 'ë‚´ìš© ì—†ìŒ'}</div>
                        <div class="text-center mt-3">
                            <button onclick="this.closest('.custom-modal-overlay').remove()" class="text-xs text-gray-400 underline">ë‹«ê¸°</button>
                        </div>
                    </div>
                `;
                document.getElementById('modal-container').appendChild(modal);
            }
        };

        // --- 4. Planner App ---
        const Planner = {
            date: new Date(), view: 'monthly',
            icons: ['ğŸ°', 'ğŸ¤', 'ğŸ’–', 'ğŸ€', 'ğŸ‚', 'â­', 'ğŸŒ¸', 'ğŸ§¸', 'ğŸ­', 'ğŸµ'],
            weathers: ['â˜€ï¸', 'â˜ï¸', 'â˜”', 'â˜ƒï¸'],
            moods: ['ğŸ¥°', 'ğŸ˜', 'ğŸ˜­', 'ğŸ˜¡', 'ğŸ¥³'],
            selectedIcon: 'ğŸ°', 
            
            // ì¼ê¸° ë°ì´í„° (ì„ì‹œ)
            currentDiary: { img: null, weather: 'â˜€ï¸', mood: 'ğŸ¥°' },

            init: () => { Planner.render(); },
            formatYMD: (y,m,d) => `${y}-${m}-${d}`,
            formatMD: (m,d) => `${m}-${d}`,
            getWeekKey: (d) => { const onejan = new Date(d.getFullYear(), 0, 1); return `${d.getFullYear()}-W${Math.ceil((((d - onejan) / 86400000) + onejan.getDay() + 1) / 7)}`; },
            closePopup: (id) => { const el = document.getElementById(id); if (el) el.remove(); },

            render: () => {
                const el = document.getElementById('app-planner'); if(!el) return;
                const y = Planner.date.getFullYear(), m = Planner.date.getMonth();
                const diary = DB.load('planner_diary_v2', {}); // Data Structure Changed
                const schedule = DB.load('planner_schedule', {});
                const yearly = DB.load('planner_yearly', {});
                const weekly = DB.load('planner_weekly', {});

                let h = `<div class="flex flex-col h-full bg-white/50"><div class="flex gap-2 p-3 border-b shrink-0">${['monthly','weekly','yearly'].map(v => `<button onclick="Planner.view='${v}';Planner.render()" class="flex-1 py-2 rounded-lg text-sm font-bold capitalize transition ${Planner.view===v?'bg-pink-400 text-white shadow-md':'text-gray-400 hover:bg-pink-50'}">${v}</button>`).join('')}</div><div class="flex-1 overflow-hidden relative">`;

                if(Planner.view === 'monthly') {
                    h += `<div class="flex flex-col h-full"><div class="flex justify-between items-center p-4 bg-white/50"><div class="flex gap-2"><select onchange="Planner.changeDate(this.value, ${m+1})" class="bg-white border-2 border-pink-100 rounded-lg px-2 py-1 text-sm font-bold text-gray-700 outline-none hover:border-pink-300">${Array.from({length: 11}, (_, i) => y - 5 + i).map(yy => `<option value="${yy}" ${yy===y?'selected':''}>${yy}ë…„</option>`).join('')}</select><select onchange="Planner.changeDate(${y}, this.value)" class="bg-white border-2 border-pink-100 rounded-lg px-2 py-1 text-sm font-bold text-gray-700 outline-none hover:border-pink-300">${Array.from({length: 12}, (_, i) => i + 1).map(mm => `<option value="${mm}" ${mm===m+1?'selected':''}>${mm}ì›”</option>`).join('')}</select></div><button onclick="Planner.today()" class="bg-pink-400 text-white px-4 py-1.5 rounded-full text-sm font-bold shadow-sm hover:bg-pink-500 transition">ì˜¤ëŠ˜</button></div><div class="calendar-grid px-4 pb-2">${['SUN','MON','TUE','WED','THU','FRI','SAT'].map((d,i)=>`<div class="text-center text-[10px] font-bold ${i===0?'text-red-400':(i===6?'text-blue-400':'text-gray-400')}">${d}</div>`).join('')}</div><div class="calendar-grid flex-1 overflow-auto px-4 pb-4">`;
                    const first = new Date(y, m, 1).getDay(); const last = new Date(y, m + 1, 0).getDate();
                    for(let i=0; i<first; i++) h += `<div></div>`;
                    const now = new Date();
                    for(let i=1; i<=last; i++) {
                        const dateKey = Planner.formatYMD(y, m+1, i);
                        const yearKey = Planner.formatMD(m+1, i);
                        const isT = now.getFullYear()===y && now.getMonth()===m && now.getDate()===i;
                        const anniv = yearly[yearKey]; const scheds = schedule[dateKey] || [];
                        const hasDiary = diary[dateKey] ? true : false;
                        h += `<div onclick="Planner.openDatePopup(${y},${m},${i})" class="calendar-day ${isT?'today':''}"><div class="flex justify-between items-start"><span class="day-num text-sm font-bold ${isT?'':(new Date(y,m,i).getDay()===0?'text-red-500':(new Date(y,m,i).getDay()===6?'text-blue-500':'text-gray-700'))}">${i}</span>${hasDiary ? '<span class="text-sm">ğŸ°</span>' : ''}</div><div class="flex flex-col gap-0.5 mt-1 overflow-hidden">${anniv ? `<div class="schedule-item yearly">ğŸ‚ ${anniv}</div>` : ''}${scheds.map(s => `<div class="schedule-item monthly">${s}</div>`).join('')}</div></div>`;
                    }
                    h += `</div></div>`;
                }
                else if(Planner.view === 'weekly') {
                    const curr = new Date(Planner.date); const day = curr.getDay(); const start = new Date(curr.setDate(curr.getDate() - day));
                    h += `<div class="flex flex-col h-full bg-pink-50/50 p-4 overflow-auto"><div class="flex justify-center items-center gap-4 mb-6"><button onclick="Planner.moveWeek(-7)"><i class="fas fa-chevron-left text-pink-300"></i></button><span class="text-lg font-bold text-pink-500 bg-white px-4 py-1 rounded-full shadow-sm border border-pink-100">${start.getMonth()+1}ì›” ${Math.ceil(start.getDate()/7)}ì£¼ì°¨ Weekly</span><button onclick="Planner.moveWeek(7)"><i class="fas fa-chevron-right text-pink-300"></i></button><button onclick="Planner.thisWeek()" class="bg-pink-300 text-white px-3 py-1 rounded-lg text-xs font-bold shadow-sm hover:bg-pink-400 absolute right-6">ì´ë²ˆ ì£¼</button></div><div class="grid grid-cols-1 gap-3">`;
                    const weekKey = Planner.getWeekKey(start); const weekData = weekly[weekKey] || {};
                    ['SUN','MON','TUE','WED','THU','FRI','SAT'].forEach((dname, idx) => {
                        const d = new Date(start); d.setDate(start.getDate() + idx); const isToday = new Date().toDateString() === d.toDateString(); const val = weekData[idx] || '';
                        h += `<div class="flex bg-white rounded-xl shadow-sm border ${isToday?'border-pink-400 ring-1 ring-pink-200':'border-pink-50'} overflow-hidden min-h-[80px]"><div class="w-14 bg-pink-50 flex flex-col items-center justify-center border-r border-pink-100"><span class="text-xs font-bold ${idx===0?'text-red-400':(idx===6?'text-blue-400':'text-gray-500')}">${dname}</span><span class="text-xl font-bold text-gray-700">${d.getDate()}</span></div><textarea onchange="Planner.saveWeekly('${weekKey}', ${idx}, this.value)" class="flex-1 p-3 text-sm resize-none outline-none text-gray-600 bg-transparent placeholder-pink-200" placeholder="ì´ë²ˆ ì£¼ ê³„íš...">${val}</textarea></div>`;
                    });
                    h += `</div></div>`;
                }
                else if(Planner.view === 'yearly') {
                    h += `<div class="flex flex-col h-full bg-pink-50/50 p-4 overflow-auto"><div class="flex justify-center items-center gap-4 mb-4"><button onclick="Planner.changeDate(${y-1}, 1)" class="text-gray-400"><i class="fas fa-chevron-left"></i></button><h2 class="text-2xl font-bold text-pink-500">${y}ë…„ <span class="text-sm font-normal text-gray-500">(ê¸°ë…ì¼)</span></h2><button onclick="Planner.changeDate(${y+1}, 1)" class="text-gray-400"><i class="fas fa-chevron-right"></i></button></div><div class="grid grid-cols-3 gap-4">`;
                    for(let i=0; i<12; i++) {
                        h += `<div class="yearly-month"><div class="text-center font-bold text-gray-700 mb-2 border-b border-pink-100 pb-1">${i+1}ì›”</div><div class="yearly-grid">`;
                        const last = new Date(y, i+1, 0).getDate(); const offset = new Date(y, i, 1).getDay();
                        for(let k=0; k<offset; k++) h+=`<div></div>`;
                        for(let d=1; d<=last; d++) { const yKey = Planner.formatMD(i+1, d); const hasAnniv = yearly[yKey]; h += `<div onclick="Planner.openYearlyInput(${i+1}, ${d})" class="yearly-day ${hasAnniv?'has-anniversary':''}" title="${hasAnniv||''}">${d}</div>`; }
                        h += `</div></div>`;
                    }
                    h += `</div><div class="text-center text-xs text-gray-400 mt-4">* ë‚ ì§œë¥¼ í´ë¦­í•˜ì—¬ ë§¤ë…„ ë°˜ë³µë˜ëŠ” ê¸°ë…ì¼ì„ ë“±ë¡í•˜ì„¸ìš”.</div></div>`;
                }
                h += `</div></div>`; el.innerHTML = h;
            },

            // --- Actions ---
            moveMonth: (d) => { Planner.date.setMonth(Planner.date.getMonth() + d); Planner.render(); },
            moveWeek: (d) => { Planner.date.setDate(Planner.date.getDate() + d); Planner.render(); },
            changeDate: (y, m) => { Planner.date.setFullYear(y); Planner.date.setMonth(m-1); Planner.render(); },
            today: () => { Planner.date = new Date(); Planner.view = 'monthly'; Planner.render(); },
            thisWeek: () => { Planner.date = new Date(); Planner.render(); },
            saveWeekly: (weekKey, dayIdx, val) => { const data = DB.load('planner_weekly', {}); if(!data[weekKey]) data[weekKey] = {}; data[weekKey][dayIdx] = val; DB.save('planner_weekly', data); },

            openYearlyInput: (m, d) => {
                Planner.closePopup('input-modal'); const key = Planner.formatMD(m, d); const data = DB.load('planner_yearly', {}); const current = data[key] || '';
                const modal = document.createElement('div'); modal.id = 'input-modal'; modal.className = 'custom-modal-overlay'; modal.onmousedown = (e) => e.stopPropagation();
                modal.innerHTML = `<div class="custom-modal-box"><h3 class="text-lg font-bold mb-3 text-pink-600">ğŸ‚ ${m}ì›” ${d}ì¼ ê¸°ë…ì¼</h3><input id="modal-input" type="text" value="${current}" class="w-full border-2 border-pink-100 rounded p-2 mb-4 text-sm focus:border-pink-300 outline-none" placeholder="ê¸°ë…ì¼ ì…ë ¥..."><div class="flex justify-end gap-2"><button onclick="Planner.closePopup('input-modal')" class="px-3 py-1 rounded text-sm text-gray-500 hover:bg-gray-100">ì·¨ì†Œ</button><button onclick="Planner.saveYearly('${key}')" class="px-3 py-1 rounded text-sm bg-pink-400 text-white font-bold hover:bg-pink-500 shadow">ì €ì¥</button></div></div>`;
                document.getElementById('modal-container').appendChild(modal); document.getElementById('modal-input').focus();
            },
            saveYearly: (key) => { const val = document.getElementById('modal-input').value; const data = DB.load('planner_yearly', {}); if(val) data[key] = val; else delete data[key]; DB.save('planner_yearly', data); Planner.closePopup('input-modal'); Planner.render(); },
            selectIcon: (icon) => { Planner.selectedIcon = icon; document.querySelectorAll('.icon-option').forEach(el => el.classList.remove('selected')); Array.from(document.querySelectorAll('.icon-option')).find(el => el.textContent === icon).classList.add('selected'); },

            openDatePopup: (y, m, d) => {
                Planner.closePopup('date-popup'); const dateKey = Planner.formatYMD(y, m+1, d); Planner.selectedIcon = Planner.icons[0];
                const modal = document.createElement('div'); modal.id = 'date-popup'; modal.className = 'custom-modal-overlay'; modal.onmousedown = (e) => e.stopPropagation();
                modal.innerHTML = `
                    <div id="popup-content-box" class="bg-white rounded-2xl w-96 shadow-2xl overflow-hidden animate-pop-in border-2 border-pink-100">
                        <div class="bg-pink-300 p-4 flex justify-between items-center text-white">
                            <h3 class="font-bold text-lg">ğŸ€ ${m+1}ì›” ${d}ì¼</h3>
                            <button onclick="Planner.closePopup('date-popup')" class="hover:text-pink-100 text-xl"><i class="fas fa-times"></i></button>
                        </div>
                        <div id="view-schedule" class="p-4 flex flex-col gap-4">
                            <div class="bg-pink-50/50 p-3 rounded-xl border border-pink-100">
                                <h4 class="text-sm font-bold text-pink-500 mb-2">ğŸ“… í•‘í¬ ì¼ì • ì¶”ê°€</h4>
                                <div class="icon-selector" id="icon-container">${Planner.icons.map(icon => `<div class="icon-option ${icon===Planner.icons[0]?'selected':''}" onclick="Planner.selectIcon('${icon}')">${icon}</div>`).join('')}</div>
                                <div class="flex gap-2">
                                    <input id="popup-schedule-input" class="flex-1 border border-pink-200 rounded px-2 py-1 text-sm outline-none focus:border-pink-400 bg-white" placeholder="ì¼ì • ì…ë ¥..." onkeypress="if(event.key==='Enter') document.getElementById('btn-add-sche').click()">
                                    <button id="btn-add-sche" class="bg-pink-400 text-white px-3 py-1 rounded text-xs hover:bg-pink-500 font-bold shadow-sm">ì¶”ê°€</button>
                                </div>
                                <ul id="popup-schedule-list" class="text-sm space-y-1 mt-3 max-h-24 overflow-auto custom-scrollbar"></ul>
                            </div>
                            <button onclick="Planner.switchView('diary', ${y}, ${m}, ${d})" class="w-full py-2 rounded-xl bg-purple-50 text-purple-500 font-bold hover:bg-purple-100 border border-purple-100 transition">ğŸ“ ê·¸ë¦¼ì¼ê¸° ì“°ëŸ¬ ê°€ê¸°</button>
                        </div>
                        <div id="view-diary" class="hidden p-0"></div>
                    </div>
                `;
                document.getElementById('modal-container').appendChild(modal); Planner.renderScheduleList(dateKey);
                modal.querySelector('#btn-add-sche').onclick = () => { const text = modal.querySelector('#popup-schedule-input').value; if(text) { const schedules = DB.load('planner_schedule', {}); const list = schedules[dateKey] || []; list.push(`${Planner.selectedIcon} ${text}`); schedules[dateKey] = list; DB.save('planner_schedule', schedules); modal.querySelector('#popup-schedule-input').value = ''; Planner.renderScheduleList(dateKey); Planner.render(); } };
            },

            renderScheduleList: (dateKey) => {
                const schedules = DB.load('planner_schedule', {}); const list = schedules[dateKey] || [];
                const ul = document.getElementById('popup-schedule-list');
                if(ul) ul.innerHTML = list.map((s, idx) => `<li class="flex justify-between items-center bg-white px-2 py-1 rounded border border-pink-100 mb-1 text-pink-600"><span>${s}</span><button onclick="Planner.removeSche('${dateKey}', ${idx})" class="text-red-300 hover:text-red-500"><i class="fas fa-times"></i></button></li>`).join('');
            },

            removeSche: (dKey, idx) => {
                const s = DB.load('planner_schedule', {}); if(s[dKey]) { s[dKey].splice(idx, 1); DB.save('planner_schedule', s); Planner.renderScheduleList(dKey); Planner.render(); }
            },

            switchView: (target, y, m, d) => {
                const box = document.getElementById('popup-content-box'); const schedView = document.getElementById('view-schedule'); const diaryView = document.getElementById('view-diary'); const dateKey = Planner.formatYMD(y, m+1, d);
                if(target === 'diary') {
                    box.classList.add('diary-modal'); schedView.classList.add('hidden'); diaryView.classList.remove('hidden');
                    const diaries = DB.load('planner_diary_v2', {}); const entry = diaries[dateKey] || { img: null, weather: 'â˜€ï¸', mood: 'ğŸ¥°', text: '' }; Planner.currentDiary = entry;
                    diaryView.innerHTML = `
                        <div class="p-4 flex flex-col gap-3 h-full">
                            <div class="picture-frame" onclick="document.getElementById('diary-img-upload').click()">${entry.img ? `<img src="${entry.img}">` : `<div class="text-center text-gray-400 text-sm"><i class="fas fa-camera text-2xl mb-1"></i><br>ì˜¤ëŠ˜ì˜ ì‚¬ì§„ì„<br>ë¶™ì—¬ì£¼ì„¸ìš”</div>`}</div><input type="file" id="diary-img-upload" class="hidden" accept="image/*" onchange="Planner.handleDiaryImage(this)">
                            <div class="flex justify-between items-center bg-gray-50 p-2 rounded-lg border border-gray-100">
                                <div class="meta-selector">${Planner.weathers.map(w => `<div class="meta-icon ${w===entry.weather?'selected':''}" onclick="Planner.setMeta('weather', '${w}')">${w}</div>`).join('')}</div>
                                <div class="w-px h-6 bg-gray-200"></div>
                                <div class="meta-selector">${Planner.moods.map(mo => `<div class="meta-icon ${mo===entry.mood?'selected':''}" onclick="Planner.setMeta('mood', '${mo}')">${mo}</div>`).join('')}</div>
                            </div>
                            <textarea id="diary-text" class="lined-paper h-32 text-sm text-gray-700" placeholder="ì˜¤ëŠ˜ í•˜ë£¨ëŠ” ì–´ë• ë‚˜ìš”?">${entry.text || ''}</textarea>
                            <div class="flex justify-between mt-2"><button onclick="Planner.switchView('schedule', ${y}, ${m}, ${d})" class="text-gray-400 text-xs underline">ì¼ì •ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button><button onclick="Planner.saveDiary('${dateKey}')" class="bg-pink-400 text-white px-4 py-1.5 rounded-lg text-sm font-bold shadow-sm hover:bg-pink-500">ì €ì¥</button></div>
                        </div>`;
                } else { box.classList.remove('diary-modal'); schedView.classList.remove('hidden'); diaryView.classList.add('hidden'); }
            },

            handleDiaryImage: (input) => { if(input.files && input.files[0]) { Utils.readFile(input.files[0], (base64) => { Planner.currentDiary.img = base64; document.querySelector('.picture-frame').innerHTML = `<img src="${base64}">`; }); } },
            setMeta: (type, val) => { Planner.currentDiary[type] = val; Array.from(document.querySelectorAll(`.meta-selector .meta-icon`)).filter(el => (type==='weather'?Planner.weathers:Planner.moods).includes(el.innerText)).forEach(el => { if(el.innerText === val) el.classList.add('selected'); else el.classList.remove('selected'); }); },
            
            saveDiary: (dateKey) => {
                const text = document.getElementById('diary-text').value; Planner.currentDiary.text = text;
                const diaries = DB.load('planner_diary_v2', {}); diaries[dateKey] = Planner.currentDiary; DB.save('planner_diary_v2', diaries);
                alert('ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆì–´! ğŸ’–'); Planner.render(); 
                Planner.closePopup('date-popup'); // ìë™ ë‹«ê¸° ì¶”ê°€
            }
        };

        // --- ê¸°íƒ€ ì•±ë“¤ ---
        const Apps = {
            notepad: {
                t: 'âœï¸ ë©”ëª¨ì¥', w: 400, h: 500, c: `<div id="app-notepad" class="h-full flex flex-col bg-pink-50/30"></div>`,
                run: () => {
                    const render = () => {
                        const list = DB.load('memos', []); const el = document.getElementById('app-notepad'); if(!el) return;
                        el.innerHTML = `<div class="p-3 bg-pink-100 flex justify-between"><span class="font-bold text-pink-600">ëª©ë¡ (${list.length})</span><button onclick="Apps.notepad.add()" class="bg-white px-2 py-1 rounded text-xs shadow text-pink-500 hover:bg-pink-50"><i class="fas fa-plus"></i> ìƒˆ ë©”ëª¨</button></div><div class="flex-1 overflow-auto p-2 space-y-2">${list.map(m => `<div class="bg-white p-3 rounded shadow-sm cursor-pointer hover:bg-pink-50 border border-pink-50" onclick="Apps.notepad.edit(${m.id})"><div class="font-bold text-sm truncate text-gray-700">${m.t||'(ì œëª©ì—†ìŒ)'}</div><div class="text-xs text-gray-400 truncate">${m.c}</div></div>`).join('')}</div>`;
                    };
                    Apps.notepad.add = () => { const l=DB.load('memos',[]); l.unshift({id:Date.now(),t:'',c:''}); DB.save('memos',l); Apps.notepad.edit(l[0].id); };
                    Apps.notepad.edit = (id) => {
                        const l=DB.load('memos',[]); const m=l.find(x=>x.id===id); if(!m) return render();
                        document.getElementById('app-notepad').innerHTML = `<div class="h-full flex flex-col"><div class="p-2 bg-pink-100 flex justify-between"><button onclick="Apps.notepad.run()" class="text-pink-500 px-2"><i class="fas fa-arrow-left"></i> ëª©ë¡</button><div class="flex gap-2"><button onclick="Apps.notepad.del(${id})" class="text-red-400 px-2"><i class="fas fa-trash"></i></button><button onclick="Apps.notepad.save(${id})" class="bg-pink-400 text-white px-3 rounded text-xs font-bold">ì €ì¥</button></div></div><input id="note-t" class="p-3 bg-transparent font-bold border-b border-pink-200 outline-none text-gray-700" value="${m.t}" placeholder="ì œëª©"><textarea id="note-c" class="flex-1 p-3 bg-transparent resize-none outline-none leading-relaxed text-gray-600">${m.c}</textarea></div>`;
                    };
                    Apps.notepad.save = (id) => { const l=DB.load('memos',[]); const i=l.findIndex(x=>x.id===id); if(i>=0){ l[i].t=document.getElementById('note-t').value; l[i].c=document.getElementById('note-c').value; DB.save('memos',l); alert('ì €ì¥ë¨!'); Apps.notepad.run(); } };
                    Apps.notepad.del = (id) => { if(confirm('ì‚­ì œí•´?')) { DB.save('memos', DB.load('memos',[]).filter(x=>x.id!==id)); Apps.notepad.run(); } }; render();
                }
            },
            planner: { t: 'ğŸ“… í•‘í¬ ë‹¤ì´ì–´ë¦¬', w: 900, h: 700, c: `<div id="app-planner" class="h-full"></div>`, run: () => Planner.init() },
            todo: {
                t: 'âœ… íˆ¬ë‘ë¦¬ìŠ¤íŠ¸', w: 350, h: 500, c: `<div id="app-todo" class="h-full flex flex-col p-3 bg-white"></div>`,
                run: () => {
                    const render = () => {
                        const l = DB.load('todos', [{id:1,t:'UX/UI ê³µë¶€í•˜ê¸°',d:false}]);
                        document.getElementById('app-todo').innerHTML = `<div class="flex gap-2 mb-4"><input id="todo-in" class="flex-1 border-2 border-pink-100 rounded px-3 py-2 text-sm outline-none focus:border-pink-300" placeholder="í•  ì¼..."><button onclick="Apps.todo.add()" class="bg-pink-400 text-white px-3 rounded hover:bg-pink-500"><i class="fas fa-plus"></i></button></div><div class="flex-1 overflow-auto space-y-2">${l.map(t=>`<div class="flex items-center gap-2 p-2 border border-pink-50 rounded hover:bg-pink-50"><input type="checkbox" ${t.d?'checked':''} onclick="Apps.todo.tog(${t.id})" class="accent-pink-400"><span class="flex-1 text-sm ${t.d?'line-through text-gray-400':''}">${t.t}</span><button onclick="Apps.todo.del(${t.id})" class="text-gray-300 hover:text-red-400"><i class="fas fa-times"></i></button></div>`).join('')}</div>`;
                    };
                    Apps.todo.add = () => { const v=document.getElementById('todo-in').value; if(v){ const l=DB.load('todos',[]); l.push({id:Date.now(),t:v,d:false}); DB.save('todos',l); render(); } };
                    Apps.todo.tog = (id) => { const l=DB.load('todos',[]); const t=l.find(x=>x.id===id); if(t){ t.d=!t.d; DB.save('todos',l); render(); } };
                    Apps.todo.del = (id) => { DB.save('todos',DB.load('todos',[]).filter(x=>x.id!==id)); render(); }; render();
                }
            },
            gallery: {
                t: 'ğŸ“· ê°¤ëŸ¬ë¦¬', w: 500, h: 600, c: `<div id="app-gallery" class="h-full flex flex-col"></div>`,
                run: () => {
                    const render = () => {
                        const l = DB.load('imgs', []);
                        document.getElementById('app-gallery').innerHTML = `<div class="p-2 border-b border-pink-100 flex justify-between bg-white"><span class="text-xs text-gray-500">${l.length}ì¥</span><label class="cursor-pointer bg-pink-400 text-white px-3 py-1 rounded-lg text-xs hover:bg-pink-500 transition shadow-sm font-bold"><i class="fas fa-upload mr-1"></i> ì‚¬ì§„ ì¶”ê°€<input type="file" class="hidden" accept="image/*" onchange="Apps.gallery.up(this)"></label></div><div class="flex-1 overflow-auto grid grid-cols-2 gap-2 p-2 bg-pink-50">${l.length?l.map((s,i)=>`<div class="aspect-square bg-white border border-pink-100 rounded-xl overflow-hidden relative group"><img src="${s}" class="w-full h-full object-cover"><button onclick="Apps.gallery.del(${i})" class="absolute inset-0 bg-black/40 text-white opacity-0 group-hover:opacity-100 flex items-center justify-center transition">ì‚­ì œ</button></div>`).join(''):'<div class="col-span-2 text-center py-10 text-gray-400">ì‚¬ì§„ì„ ì˜¬ë ¤ì¤˜!</div>'}</div>`;
                    };
                    Apps.gallery.up = (el) => { if(el.files[0]) Utils.readFile(el.files[0], d => { const l=DB.load('imgs',[]); l.unshift(d); DB.save('imgs',l); render(); }); };
                    Apps.gallery.del = (i) => { if(confirm('ì§€ì›Œ?')) { const l=DB.load('imgs',[]); l.splice(i,1); DB.save('imgs',l); render(); } }; render();
                }
            },
            profile: {
                t: 'ğŸ° í”„ë¡œí•„', w: 380, h: 500, c: `<div id="app-profile" class="h-full overflow-auto bg-gradient-to-b from-white to-pink-50 p-6 flex flex-col items-center gap-4"></div>`,
                run: () => {
                    const d = DB.load('profile', {img:'https://api.dicebear.com/7.x/avataaars/svg?seed=Saebom', name:'ì¡°ìƒˆë´„', mbti:'ISFJ'});
                    const el = document.getElementById('app-profile');
                    el.innerHTML = `<div class="relative group cursor-pointer" onclick="document.getElementById('pf-up').click()"><div class="w-32 h-32 rounded-full border-4 border-pink-200 overflow-hidden bg-white shadow-md"><img src="${d.img}" class="w-full h-full object-cover"></div><div class="absolute inset-0 bg-black/30 rounded-full flex items-center justify-center text-white opacity-0 group-hover:opacity-100 font-bold text-sm">ë³€ê²½</div><input id="pf-up" type="file" class="hidden" accept="image/*" onchange="Apps.profile.up(this)"></div><div class="text-center"><h2 class="text-2xl font-bold text-gray-800">${d.name}</h2><p class="text-pink-400 text-sm font-bold">Web Designer</p></div><div class="w-full bg-white/70 p-4 rounded-xl shadow-sm text-sm space-y-2 border border-pink-100"><p>ğŸ‚ 1996.11.04</p><p>ğŸ  ì„œìš¸ ê±°ì£¼</p><p>ğŸ§© ${d.mbti}</p><p>ğŸ’– í† ë¼, ë ˆì´ìŠ¤, í•‘í¬</p></div>`;
                    Apps.profile.up = (el) => { if(el.files[0]) Utils.readFile(el.files[0], s => { d.img=s; DB.save('profile',d); Apps.profile.run(); }); };
                }
            },
            goal: { t: 'ğŸ¯ ëª©í‘œ', w: 400, h: 400, c: `<div id="app-goal" class="h-full"></div>`, run: () => GoalApp.init() },
            diary_viewer: { t: 'ğŸ“– ê·¸ë¦¼ì¼ê¸° ëª¨ì•„ë³´ê¸°', w: 700, h: 600, c: `<div id="app-diary-viewer" class="h-full"></div>`, run: () => DiaryViewer.init() }
        };

        const app = {
            sky: null, wm: null,
            init: () => {
                app.sky = new SkyRenderer(); app.wm = new WindowManager(); DDayApp.init();
                const update = () => { document.getElementById('clock-time').innerText = Utils.formatTime(); }; setInterval(update, 1000); update();
                fetch('https://api.open-meteo.com/v1/forecast?latitude=37.5665&longitude=126.9780&current_weather=true').then(r=>r.json()).then(d=>{ document.getElementById('weather-text').innerText = `ë§‘ìŒ ${Math.round(d.current_weather.temperature)}Â°C`; }).catch(()=>{});
                setTimeout(() => { document.getElementById('loading-screen').style.opacity = '0'; setTimeout(()=>document.getElementById('loading-screen').remove(),700); }, 1000);
            },
            openWindow: (id) => { const a = Apps[id]; if(!a) return; app.wm.create(id, a.t, a.c, a.w, a.h); if(a.run) setTimeout(a.run, 0); },
            close: (id) => app.wm.close(id), max: (id) => app.wm.max(id),
            toggleTheme: () => { app.sky.night = !app.sky.night; document.getElementById('theme-icon').className = app.sky.night ? 'fas fa-moon text-3xl text-yellow-100' : 'fas fa-sun text-3xl text-yellow-400'; }
        };
        window.onload = app.init;
    </script>
</body>
</html>